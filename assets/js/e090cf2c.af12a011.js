"use strict";(self.webpackChunkcypress_docusaurus_zh=self.webpackChunkcypress_docusaurus_zh||[]).push([[7692],{8828:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>t,default:()=>h,frontMatter:()=>c,metadata:()=>o,toc:()=>l});var i=s(5893),r=s(1151);const c={title:"wrap"},t=void 0,o={id:"api/commands/wrap",title:"wrap",description:"Yield the object passed into .wrap(). If the object is a promise, yield its",source:"@site/docs/api/commands/wrap.mdx",sourceDirName:"api/commands",slug:"/api/commands/wrap",permalink:"/api/commands/wrap",draft:!1,unlisted:!1,editUrl:"https://github.com/cypress-io/cypress-documentation/tree/main/docs/api/commands/wrap.mdx",tags:[],version:"current",lastUpdatedAt:1732009455,formattedLastUpdatedAt:"Nov 19, 2024",frontMatter:{title:"wrap"},sidebar:"api",previous:{title:"within",permalink:"/api/commands/within"},next:{title:"writeFile",permalink:"/api/commands/writefile"}},a={},l=[{value:"Syntax",id:"Syntax",level:2},{value:"Usage",id:"Usage",level:3},{value:"Arguments",id:"Arguments",level:3},{value:"Yields <Icon></Icon>",id:"Yields",level:3},{value:"Examples",id:"Examples",level:2},{value:"Objects",id:"Objects",level:3},{value:"Invoke the function on the subject in wrap and return the new value",id:"Invoke-the-function-on-the-subject-in-wrap-and-return-the-new-value",level:4},{value:"Elements",id:"Elements",level:3},{value:"Wrap elements to continue executing commands",id:"Wrap-elements-to-continue-executing-commands",level:4},{value:"Conditionally wrap elements",id:"Conditionally-wrap-elements",level:4},{value:"Promises",id:"Promises",level:3},{value:"Simple example",id:"Simple-example",level:4},{value:"Application example <E2EOnlyBadge></E2EOnlyBadge>",id:"Application-example",level:4},{value:"Rules",id:"Rules",level:2},{value:"Requirements <Icon></Icon>",id:"Requirements",level:3},{value:"Assertions <Icon></Icon>",id:"Assertions",level:3},{value:"Timeouts <Icon></Icon>",id:"Timeouts",level:3},{value:"Command Log",id:"Command-Log",level:2},{value:"History",id:"History",level:2},{value:"See also",id:"See-also",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components},{DocsImage:s,E2EOnlyBadge:c,Icon:t}=n;return s||p("DocsImage",!0),c||p("E2EOnlyBadge",!0),t||p("Icon",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["Yield the object passed into ",(0,i.jsx)(n.code,{children:".wrap()"}),". If the object is a promise, yield its\nresolved value."]}),"\n",(0,i.jsx)(n.h2,{id:"Syntax",children:"Syntax"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"cy.wrap(subject)\ncy.wrap(subject, options)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"Usage",children:"Usage"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(t,{name:"check-circle",color:"green"})," ",(0,i.jsx)(n.strong,{children:"Correct Usage"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"cy.wrap({ name: 'Jane Lane' })\n"})}),"\n",(0,i.jsx)(n.h3,{id:"Arguments",children:"Arguments"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(t,{name:"angle-right"})," ",(0,i.jsxs)(n.strong,{children:["subject ",(0,i.jsx)(n.em,{children:"(Object)"})]})]}),"\n",(0,i.jsx)(n.p,{children:"An object to be yielded."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(t,{name:"angle-right"})," ",(0,i.jsxs)(n.strong,{children:["options ",(0,i.jsx)(n.em,{children:"(Object)"})]})]}),"\n",(0,i.jsxs)(n.p,{children:["Pass in an options object to change the default behavior of ",(0,i.jsx)(n.code,{children:"cy.wrap()"}),"."]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Option"}),(0,i.jsx)(n.th,{children:"Default"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"log"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"true"})}),(0,i.jsxs)(n.td,{children:["Displays the command in the ",(0,i.jsx)(n.a,{href:"/app/core-concepts/open-mode#Command-Log",children:"Command log"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"timeout"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"/app/references/configuration#Timeouts",children:(0,i.jsx)(n.code,{children:"defaultCommandTimeout"})})}),(0,i.jsxs)(n.td,{children:["Time to wait for ",(0,i.jsx)(n.code,{children:"cy.wrap()"})," to resolve before ",(0,i.jsx)(n.a,{href:"#Timeouts",children:"timing out"})]})]})]})]}),"\n",(0,i.jsxs)(n.h3,{id:"Yields",children:["Yields ",(0,i.jsx)(n.a,{href:"/app/core-concepts/introduction-to-cypress#Subject-Management",children:(0,i.jsx)(t,{name:"question-circle"})})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cy.wrap()"})," yields the object it was called with."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"Examples",children:"Examples"}),"\n",(0,i.jsx)(n.h3,{id:"Objects",children:"Objects"}),"\n",(0,i.jsx)(n.h4,{id:"Invoke-the-function-on-the-subject-in-wrap-and-return-the-new-value",children:"Invoke the function on the subject in wrap and return the new value"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"const getName = () => {\n  return 'Jane Lane'\n}\n\ncy.wrap({ name: getName }).invoke('name').should('eq', 'Jane Lane') // true\n"})}),"\n",(0,i.jsx)(n.h3,{id:"Elements",children:"Elements"}),"\n",(0,i.jsx)(n.h4,{id:"Wrap-elements-to-continue-executing-commands",children:"Wrap elements to continue executing commands"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"cy.get('form').within(($form) => {\n  // ... more commands\n\n  cy.wrap($form).should('have.class', 'form-container')\n})\n"})}),"\n",(0,i.jsx)(n.h4,{id:"Conditionally-wrap-elements",children:"Conditionally wrap elements"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"cy.get('button').then(($button) => {\n  // $button is a wrapped jQuery element\n  if ($button.someMethod() === 'something') {\n    // wrap this element so we can\n    // use cypress commands on it\n    cy.wrap($button).click()\n  } else {\n    // do something else\n  }\n})\n"})}),"\n",(0,i.jsx)(n.h3,{id:"Promises",children:"Promises"}),"\n",(0,i.jsxs)(n.p,{children:["You can wrap promises returned by the application code. Cypress commands will\nautomatically wait for the promise to resolve before continuing with the yielded\nvalue to the next command or assertion. See the\n",(0,i.jsx)(n.a,{href:"/app/references/recipes#Logging-In",children:"Logging in using application code"})," recipe for the\nfull example."]}),"\n",(0,i.jsx)(n.h4,{id:"Simple-example",children:"Simple example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const myPromise = new Promise((resolve, reject) => {\n  // we use setTimeout(...) to simulate async code.\n  setTimeout(() => {\n    resolve({\n      type: 'success',\n      message: 'It worked!',\n    })\n  }, 2500)\n})\n\nit('should wait for promises to resolve', () => {\n  cy.wrap(myPromise).its('message').should('eq', 'It worked!')\n})\n"})}),"\n",(0,i.jsx)(s,{src:"/img/api/wrap/cypress-wrapped-promise-waits-to-resolve.gif",alt:"Wrap of promises"}),"\n",(0,i.jsxs)(n.h4,{id:"Application-example",children:["Application example ",(0,i.jsx)(c,{})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// import application code for logging in\nimport { userService } from '../../src/_services/user.service'\n\nit('can assert against resolved object using .should', () => {\n  cy.log('user service login')\n  const username = Cypress.env('username')\n  const password = Cypress.env('password')\n\n  // wrap the promise returned by the application code\n  cy.wrap(userService.login(username, password))\n    // check the yielded object\n    .should('be.an', 'object')\n    .and('have.keys', ['firstName', 'lastName', 'username', 'id', 'token'])\n    .and('contain', {\n      username: 'test',\n      firstName: 'Test',\n      lastName: 'User',\n    })\n\n  // cy.visit command will wait for the promise returned from\n  // the \"userService.login\" to resolve. Then local storage item is set\n  // and the visit will immediately be authenticated and logged in\n  cy.visit('/')\n  // we should be logged in\n  cy.contains('Hi Test!').should('be.visible')\n})\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," ",(0,i.jsx)(n.code,{children:".wrap()"})," will not synchronize asynchronous function calls for you.\nFor example, given the following example:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["You have two async functions ",(0,i.jsx)(n.code,{children:"async function foo() {...}"})," and\n",(0,i.jsx)(n.code,{children:"async function bar() {...}"})]}),"\n",(0,i.jsxs)(n.li,{children:["You need to make sure ",(0,i.jsx)(n.code,{children:"foo()"})," has resolved first before invoking ",(0,i.jsx)(n.code,{children:"bar()"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"bar()"})," is also dependent on some data that is created while after calling\nother Cypress commands."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(t,{name:"exclamation-triangle",color:"red"})," If you wrap the asynchronous functions\nin ",(0,i.jsx)(n.code,{children:"cy.wrap()"}),", then ",(0,i.jsx)(n.code,{children:"bar()"})," may be called prematurely before the required data is\navailable:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"cy.wrap(foo())\n\ncy.get('some-button').click()\ncy.get('some-input').type(someValue)\ncy.get('some-submit-button').click()\n\n// this will execute `bar()` immediately without waiting\n// for other cy.get(...) functions to complete\ncy.wrap(bar()) // DON'T DO THIS\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This behavior is due to the function invocation ",(0,i.jsx)(n.code,{children:"foo()"})," and ",(0,i.jsx)(n.code,{children:"bar()"}),", which call\nthe functions immediately to return a Promise."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(t,{name:"check-circle",color:"green"})," If you want ",(0,i.jsx)(n.code,{children:"bar()"})," to execute after ",(0,i.jsx)(n.code,{children:"foo()"}),"\nand the ",(0,i.jsx)(n.a,{href:"/api/commands/get",children:"cy.get()"})," commands, one solution is to chain off the\nfinal command using ",(0,i.jsx)(n.a,{href:"/api/commands/then",children:".then()"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"cy.wrap(foo())\n\ncy.get('some-button').click()\ncy.get('some-input').type(someValue)\ncy.get('some-submit-button')\n  .click()\n  .then(() => {\n    // this will execute `bar()` after the\n    // other cy.get(...) functions complete\n    cy.wrap(bar())\n  })\n"})}),"\n",(0,i.jsx)(n.h2,{id:"Rules",children:"Rules"}),"\n",(0,i.jsxs)(n.h3,{id:"Requirements",children:["Requirements ",(0,i.jsx)(n.a,{href:"/app/core-concepts/introduction-to-cypress#Chains-of-Commands",children:(0,i.jsx)(t,{name:"question-circle"})})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cy.wrap()"})," requires being chained off of ",(0,i.jsx)(n.code,{children:"cy"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"Assertions",children:["Assertions ",(0,i.jsx)(n.a,{href:"/app/core-concepts/introduction-to-cypress#Assertions",children:(0,i.jsx)(t,{name:"question-circle"})})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cy.wrap()"}),", when its argument is a promise, will automatically wait until the\npromise resolves. If the promise is rejected, ",(0,i.jsx)(n.code,{children:"cy.wrap()"})," will fail the test."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cy.wrap()"})," will automatically ",(0,i.jsx)(n.a,{href:"/app/core-concepts/retry-ability",children:"retry"}),"\nuntil all chained assertions have passed."]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"Timeouts",children:["Timeouts ",(0,i.jsx)(n.a,{href:"/app/core-concepts/introduction-to-cypress#Timeouts",children:(0,i.jsx)(t,{name:"question-circle"})})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cy.wrap()"})," can time out waiting for assertions you've added to pass."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"Command-Log",children:"Command Log"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Make assertions about object"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"cy.wrap({ amount: 10 }).should('have.property', 'amount').and('eq', 10)\n"})}),"\n",(0,i.jsx)(n.p,{children:"The commands above will display in the Command Log as:"}),"\n",(0,i.jsx)(s,{src:"/img/api/wrap/wrapped-object-in-cypress-tests.png",alt:"Command Log wrap"}),"\n",(0,i.jsxs)(n.p,{children:["When clicking on the ",(0,i.jsx)(n.code,{children:"wrap"})," command within the command log, the console outputs\nthe following:"]}),"\n",(0,i.jsx)(s,{src:"/img/api/wrap/console-log-only-shows-yield-of-wrap.png",alt:"Console Log wrap"}),"\n",(0,i.jsx)(n.h2,{id:"History",children:"History"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Version"}),(0,i.jsx)(n.th,{children:"Changes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"/app/references/changelog#3-2-0",children:"3.2.0"})}),(0,i.jsxs)(n.td,{children:["Retry ",(0,i.jsx)(n.code,{children:"cy.wrap()"})," if ",(0,i.jsx)(n.code,{children:"undefined"})," when followed by ",(0,i.jsx)(n.a,{href:"/api/commands/should",children:".should()"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"/app/references/changelog#0-4-5",children:"0.4.5"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"cy.wrap()"})," command added"]})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"See-also",children:"See also"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/api/commands/invoke",children:(0,i.jsx)(n.code,{children:".invoke()"})})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/api/commands/its",children:(0,i.jsx)(n.code,{children:".its()"})})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/api/commands/should",children:(0,i.jsx)(n.code,{children:".should()"})})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/api/commands/spread",children:(0,i.jsx)(n.code,{children:".spread()"})})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/api/commands/then",children:(0,i.jsx)(n.code,{children:".then()"})})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/app/references/recipes#Logging-In",children:"Logging In: Using application code"})," recipe"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/app/references/recipes#Unit-Testing",children:"Unit Testing: Application Code"})," recipe"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}function p(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},1151:(e,n,s)=>{s.d(n,{Z:()=>o,a:()=>t});var i=s(7294);const r={},c=i.createContext(r);function t(e){const n=i.useContext(c);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(c.Provider,{value:n},e.children)}}}]);