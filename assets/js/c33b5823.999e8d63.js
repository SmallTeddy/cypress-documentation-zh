"use strict";(self.webpackChunkcypress_docusaurus_zh=self.webpackChunkcypress_docusaurus_zh||[]).push([[1779],{9647:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>d,toc:()=>l});var s=r(5893),i=r(1151);const c={title:"Cypress.require",e2eSpecific:!0},o=void 0,d={id:"api/cypress-api/require",title:"Cypress.require",description:"Cypress.require enables utilizing dependencies within the",source:"@site/docs/api/cypress-api/require.mdx",sourceDirName:"api/cypress-api",slug:"/api/cypress-api/require",permalink:"/api/cypress-api/require",draft:!1,unlisted:!1,editUrl:"https://github.com/cypress-io/cypress-documentation/tree/main/docs/api/cypress-api/require.mdx",tags:[],version:"current",lastUpdatedAt:1732009455,formattedLastUpdatedAt:"Nov 19, 2024",frontMatter:{title:"Cypress.require",e2eSpecific:!0},sidebar:"api",previous:{title:"Cypress.platform",permalink:"/api/cypress-api/platform"},next:{title:"Cypress.Screenshot",permalink:"/api/cypress-api/screenshot-api"}},t={},l=[{value:"Syntax",id:"Syntax",level:2},{value:"Usage",id:"Usage",level:2},{value:"TypeScript",id:"TypeScript",level:2},{value:"Casting",id:"Casting",level:3},{value:"Generic",id:"Generic",level:3},{value:"Limitations / Requirements",id:"Limitations--Requirements",level:2},{value:"Why not <code>require</code> or <code>import</code>?",id:"Why-not-require-or-import",level:2},{value:"History",id:"History",level:2},{value:"See also",id:"See-also",level:2}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components},{Icon:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Icon",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Cypress.require"})," enables utilizing dependencies within the\n",(0,s.jsx)(n.a,{href:"/api/commands/origin",children:(0,s.jsx)(n.code,{children:"cy.origin()"})})," callback function. It is used to require\nmodules such as ",(0,s.jsx)(n.a,{href:"https://www.npmjs.com/",children:"npm"})," packages and other local files."]}),"\n",(0,s.jsxs)(n.p,{children:["It is functionally the same as using\n",(0,s.jsxs)(n.a,{href:"https://nodejs.org/api/modules.html#requireid",children:["CommonJS ",(0,s.jsx)(n.code,{children:"require()"})]}),"\nin browser-targeted code."]}),"\n",(0,s.jsx)(n.h2,{id:"Syntax",children:"Syntax"}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsxs)(n.p,{children:["Using ",(0,s.jsx)(n.code,{children:"Cypress.require()"})," within the ",(0,s.jsx)(n.a,{href:"https://docs.cypress.io/api/commands/origin",children:(0,s.jsx)(n.code,{children:"cy.origin()"})}),"\ncallback requires enabling the\n",(0,s.jsx)(n.a,{href:"/app/references/experiments#End-to-End-Testing",children:(0,s.jsx)(n.code,{children:"experimentalOriginDependencies"})})," option in the Cypress configuration."]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"Cypress.require(moduleNameOrPath)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"Usage",children:"Usage"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(r,{name:"check-circle",color:"green"})," ",(0,s.jsx)(n.strong,{children:"Correct Usage"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"cy.origin('cypress.io', () => {\n  const _ = Cypress.require('lodash')\n  const utils = Cypress.require('./utils')\n\n  // ... use lodash and utils ...\n})\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(r,{name:"exclamation-triangle",color:"red"})," ",(0,s.jsx)(n.strong,{children:"Incorrect Usage"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// `Cypress.require()` cannot be used outside the `cy.origin()` callback.\n// Use CommonJS `require()` instead\nconst _ = Cypress.require('lodash')\n\ncy.origin('cypress.io', async () => {\n  // `require()` and `import()` cannot be used inside the `cy.origin()` callback.\n  // Use `Cypress.require()` instead\n  const _ = require('lodash')\n  const utils = await import('./utils')\n})\n"})}),"\n",(0,s.jsxs)(n.p,{children:["See\n",(0,s.jsxs)(n.a,{href:"/api/commands/origin#Dependencies--Sharing-Code",children:[(0,s.jsx)(n.code,{children:"cy.origin()"})," Dependencies / Sharing Code"]}),"\nfor more example usage."]}),"\n",(0,s.jsx)(n.h2,{id:"TypeScript",children:"TypeScript"}),"\n",(0,s.jsx)(n.p,{children:"There are couple ways to have types inferred for the dependency required."}),"\n",(0,s.jsx)(n.h3,{id:"Casting",children:"Casting"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"cy.origin('cypress.io', async () => {\n  const _ = Cypress.require('lodash') as typeof import('lodash')\n\n  // lodash methods are properly typed\n  _.map([1, 2, 3], (num: number) => {\n    // ...\n  })\n})\n"})}),"\n",(0,s.jsx)(n.h3,{id:"Generic",children:"Generic"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"import type { LoDashStatic } from 'lodash'\n\ncy.origin('cypress.io', async () => {\n  const _ = Cypress.require < LoDashStatic > 'lodash'\n\n  // lodash methods are properly typed\n  _.map([1, 2, 3], (num: number) => {\n    // ...\n  })\n})\n"})}),"\n",(0,s.jsx)(n.h2,{id:"Limitations--Requirements",children:"Limitations / Requirements"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Cypress.require"})," only works when called within the\n",(0,s.jsx)(n.a,{href:"/api/commands/origin",children:(0,s.jsx)(n.code,{children:"cy.origin()"})})," callback function. It will error if used\nelsewhere."]}),"\n",(0,s.jsxs)(n.li,{children:["Only the following file extensions are supported for dependencies required\n(either directly or indirectly):","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:".js"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:".jsx"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:".ts"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:".tsx"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:".mjs"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:".json"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:".coffee"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Cypress.require('dependency-name')"})," must on one line as a continuous string:"]}),"\n"]}),"\n","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// \u2705 GOOD\nCypress.require('lodash')\n\n// \u274c BAD\nconst { require } = Cypress\nrequire('lodash')\n\n// \u274c BAD\nCypress\n.require('lodash')\n\n// \u274c BAD\nCypress . require('lodash')\n\n// \u274c BAD\nCypress.require(\n  'lodash'\n)\n"})}),"\n","\n",(0,s.jsxs)(n.h2,{id:"Why-not-require-or-import",children:["Why not ",(0,s.jsx)(n.code,{children:"require"})," or ",(0,s.jsx)(n.code,{children:"import"}),"?"]}),"\n",(0,s.jsxs)(n.p,{children:["Cypress runs test code in the browser, so any dependencies have to be bundled\nwith the test code before it is run. This is accomplished for the majority of\ntest code via a ",(0,s.jsx)(n.a,{href:"/api/node-events/preprocessors-api",children:"preprocessor"}),". However, due to\nthe way that ",(0,s.jsx)(n.a,{href:"/api/commands/origin",children:(0,s.jsx)(n.code,{children:"cy.origin()"})})," works, the callback passed to\nit is extracted from the test code where it is defined and run in a different\ncontext. This also separates it from any dependencies that are included in the\ntest code bundle."]}),"\n",(0,s.jsxs)(n.p,{children:["To solve this, we replace all instances of ",(0,s.jsx)(n.code,{children:"Cypress.require"})," with ",(0,s.jsx)(n.code,{children:"require"})," at\nruntime and bundle just the callback with any dependencies required within it."]}),"\n",(0,s.jsxs)(n.p,{children:["Using ",(0,s.jsx)(n.code,{children:"Cypress.require"})," in the test code instead of ",(0,s.jsx)(n.code,{children:"require"})," or ",(0,s.jsx)(n.code,{children:"import"})," keeps\nthe dependencies required within the callback from being bundled with the rest\nof the test code. We cannot bring them along with the callback to where it is\nrun, so it would waste execution time and memory to bundle its dependencies in\nthe original preprocessing. The dependencies are only bundled with the code that\nneeds them when we preprocess the callback itself."]}),"\n",(0,s.jsxs)(n.p,{children:["Additionally, we tried a solution previously that allowed use of ",(0,s.jsx)(n.code,{children:"require"})," and\n",(0,s.jsx)(n.code,{children:"import"}),", but found that it hurt performance not only for spec files using them\nwithin the ",(0,s.jsx)(n.code,{children:"cy.origin()"})," callback, but even for spec files that did not use\nthem. That solution was also preprocessor-dependent and only worked for the\nwebpack preprocessor. Using ",(0,s.jsx)(n.code,{children:"Cypress.require"})," is preprocessor-agnostic."]}),"\n",(0,s.jsx)(n.h2,{id:"History",children:"History"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Version"}),(0,s.jsx)(n.th,{children:"Changes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/app/references/changelog#12-6-0",children:"12.6.0"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"Cypress.require"})," added and support for using CommonJS ",(0,s.jsx)(n.code,{children:"require()"})," and ES module ",(0,s.jsx)(n.code,{children:"import()"})," removed"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/app/references/changelog#10-11-0",children:"10.11.0"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"Cypress.require"})," removed in favor of CommonJS ",(0,s.jsx)(n.code,{children:"require()"})," and ES module ",(0,s.jsx)(n.code,{children:"import()"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/app/references/changelog#10-7-0",children:"10.7.0"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"Cypress.require"})," added"]})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"See-also",children:"See also"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/api/commands/origin",children:(0,s.jsx)(n.code,{children:"cy.origin()"})})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},1151:(e,n,r)=>{r.d(n,{Z:()=>d,a:()=>o});var s=r(7294);const i={},c=s.createContext(i);function o(e){const n=s.useContext(c);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(c.Provider,{value:n},e.children)}}}]);