"use strict";(self.webpackChunkcypress_docusaurus_zh=self.webpackChunkcypress_docusaurus_zh||[]).push([[2146],{852:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>c,toc:()=>l});var r=s(5893),t=s(1151);const i={title:"Cypress.Screenshot"},o=void 0,c={id:"api/cypress-api/screenshot-api",title:"Cypress.Screenshot",description:"The Screenshot API allows you set defaults for how screenshots are captured",source:"@site/docs/api/cypress-api/screenshot-api.mdx",sourceDirName:"api/cypress-api",slug:"/api/cypress-api/screenshot-api",permalink:"/api/cypress-api/screenshot-api",draft:!1,unlisted:!1,editUrl:"https://github.com/cypress-io/cypress-documentation/tree/main/docs/api/cypress-api/screenshot-api.mdx",tags:[],version:"current",lastUpdatedAt:1732009455,formattedLastUpdatedAt:"Nov 19, 2024",frontMatter:{title:"Cypress.Screenshot"},sidebar:"api",previous:{title:"Cypress.require",permalink:"/api/cypress-api/require"},next:{title:"Cypress.SelectorPlayground",permalink:"/api/cypress-api/selector-playground-api"}},a={},l=[{value:"Syntax",id:"Syntax",level:2},{value:"Arguments",id:"Arguments",level:3},{value:"Examples",id:"Examples",level:2},{value:"Blackout elements before screenshot",id:"Blackout-elements-before-screenshot",level:3},{value:"Take a screenshot of the entire Cypress browser window",id:"Take-a-screenshot-of-the-entire-Cypress-browser-window",level:3},{value:"Allow timers and animations to keep running",id:"Allow-timers-and-animations-to-keep-running",level:3},{value:"Disable screenshots on run failures",id:"Disable-screenshots-on-run-failures",level:3},{value:"Overwrite existing screenshots",id:"Overwrite-existing-screenshots",level:3},{value:"Scale <code>viewport</code> and <code>fullPage</code> captures",id:"Scale-viewport-and-fullPage-captures",level:3},{value:"Change the DOM using <code>onBeforeScreenshot</code> and <code>onAfterScreenshot</code>",id:"Change-the-DOM-using-onBeforeScreenshot-and-onAfterScreenshot",level:3},{value:"Get properties from the <code>onAfterScreenshot</code> callback",id:"Get-properties-from-the-onAfterScreenshot-callback",level:3},{value:"Notes",id:"Notes",level:2},{value:"Where to put screenshot configuration",id:"Where-to-put-screenshot-configuration",level:4},{value:"History",id:"History",level:2},{value:"See also",id:"See-also",level:2}];function h(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.a)(),...e.components},{Icon:s,SupportFileConfiguration:i}=n;return s||u("Icon",!0),i||u("SupportFileConfiguration",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["The Screenshot API allows you set defaults for how screenshots are captured\nduring ",(0,r.jsx)(n.a,{href:"/api/commands/screenshot",children:".screenshot"})," and automatic screenshots taken\nduring test failures. You can set defaults for the following:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Which parts of the screen to capture."}),"\n",(0,r.jsx)(n.li,{children:"Whether to scale your application under test in the screenshot."}),"\n",(0,r.jsx)(n.li,{children:"Whether to disable JavaScript timers and CSS animations when taking the\nscreenshot."}),"\n",(0,r.jsx)(n.li,{children:"Whether to automatically take screenshots when there are run failures."}),"\n",(0,r.jsx)(n.li,{children:"Which, if any, elements to black out when taking the screenshot."}),"\n",(0,r.jsx)(n.li,{children:"Whether to wait for the Command Log to synchronize before taking the\nscreenshot."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"Syntax",children:"Syntax"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"Cypress.Screenshot.defaults(options)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"Arguments",children:"Arguments"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(s,{name:"angle-right"})," ",(0,r.jsxs)(n.strong,{children:["options ",(0,r.jsx)(n.em,{children:"(Object)"})]})]}),"\n",(0,r.jsx)(n.p,{children:"An object containing one or more of the following:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Option"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"blackout"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"[]"})}),(0,r.jsxs)(n.td,{children:["Array of string selectors used to match elements that should be blacked out when the screenshot is taken. Does not apply to ",(0,r.jsx)(n.code,{children:"runner"})," captures."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"capture"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"'fullPage'"})}),(0,r.jsxs)(n.td,{children:["Which parts of the Cypress Test Runner to capture. This value is ignored for element screenshot captures. Valid values are ",(0,r.jsx)(n.code,{children:"viewport"}),", ",(0,r.jsx)(n.code,{children:"fullPage"}),", or ",(0,r.jsx)(n.code,{children:"runner"}),". When ",(0,r.jsx)(n.code,{children:"viewport"}),", your application under test is captured in the current viewport. When ",(0,r.jsx)(n.code,{children:"fullPage"}),", your application under test is captured in its entirety from top to bottom. When ",(0,r.jsx)(n.code,{children:"runner"}),", the entire browser viewport, including the Cypress Command Log, is captured. For screenshots automatically taken on test failure, capture is always coerced to ",(0,r.jsx)(n.code,{children:"runner"}),". When ",(0,r.jsx)(n.a,{href:"/cloud/features/test-replay",children:"Test Replay"})," is enabled and the Runner UI is hidden, a ",(0,r.jsx)(n.code,{children:"runner"})," screenshot will not include the Runner UI and will instead capture the application under test only in the current viewport."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"disableTimersAndAnimations"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"true"})}),(0,r.jsxs)(n.td,{children:["When true, prevents JavaScript timers (",(0,r.jsx)(n.code,{children:"setTimeout"}),", ",(0,r.jsx)(n.code,{children:"setInterval"}),", etc) and CSS animations from running while the screenshot is taken."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"scale"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false"})}),(0,r.jsxs)(n.td,{children:["Whether to scale the app to fit into the browser viewport. This is always coerced to ",(0,r.jsx)(n.code,{children:"true"})," for ",(0,r.jsx)(n.code,{children:"runner"})," captures."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"screenshotOnRunFailure"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"true"})}),(0,r.jsxs)(n.td,{children:["When true, automatically takes a screenshot when there is a failure during ",(0,r.jsx)(n.code,{children:"cypress run"}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"overwrite"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false"})}),(0,r.jsx)(n.td,{children:"Whether to overwrite duplicate screenshot files with the same file name when saving."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"onBeforeScreenshot"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"null"})}),(0,r.jsxs)(n.td,{children:["A callback before a (non-failure) screenshot is taken. For an element capture, the argument is the element being captured. For other screenshots, the argument is the ",(0,r.jsx)(n.code,{children:"$el"}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"onAfterScreenshot"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"null"})}),(0,r.jsxs)(n.td,{children:["A callback after a (non-failure) screenshot is taken. For an element capture, the first argument is the element being captured. For other screenshots, the first argument is the ",(0,r.jsx)(n.code,{children:"$el"}),". The second argument is properties concerning the screenshot, including the path it was saved to and the dimensions of the saved screenshot."]})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"Examples",children:"Examples"}),"\n",(0,r.jsx)(n.h3,{id:"Blackout-elements-before-screenshot",children:"Blackout elements before screenshot"}),"\n",(0,r.jsxs)(n.p,{children:["Elements that match the specified selectors will be blacked out from the\nscreenshot, but only when the ",(0,r.jsx)(n.code,{children:"capture"})," option is ",(0,r.jsx)(n.code,{children:"viewport"}),". ",(0,r.jsx)(n.code,{children:"blackout"})," is\nignored if ",(0,r.jsx)(n.code,{children:"capture"})," option is ",(0,r.jsx)(n.code,{children:"runner"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"Cypress.Screenshot.defaults({\n  blackout: ['.secret-info', '[data-hide=true]'],\n})\n"})}),"\n",(0,r.jsx)(n.h3,{id:"Take-a-screenshot-of-the-entire-Cypress-browser-window",children:"Take a screenshot of the entire Cypress browser window"}),"\n",(0,r.jsxs)(n.p,{children:["By default, ",(0,r.jsx)(n.a,{href:"/api/commands/screenshot",children:(0,r.jsx)(n.code,{children:"cy.screenshot()"})})," only captures your\napplication under test. You may want it to capture the entire Cypress browser\nfor debugging purposes."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"Cypress.Screenshot.defaults({\n  capture: 'runner',\n})\n"})}),"\n",(0,r.jsx)(n.h3,{id:"Allow-timers-and-animations-to-keep-running",children:"Allow timers and animations to keep running"}),"\n",(0,r.jsx)(n.p,{children:"By default, JavaScript timers and CSS animations are disabled to try to prevent\nchanges to your application under test while the screenshot is taken, but you\ncan turn off this behavior."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"Cypress.Screenshot.defaults({\n  disableTimersAndAnimations: false,\n})\n"})}),"\n",(0,r.jsx)(n.h3,{id:"Disable-screenshots-on-run-failures",children:"Disable screenshots on run failures"}),"\n",(0,r.jsxs)(n.p,{children:["By default, Cypress automatically takes a screenshot when there is a failure\nwhen running ",(0,r.jsx)(n.code,{children:"cypress run"}),", but you can disable this."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"Cypress.Screenshot.defaults({\n  screenshotOnRunFailure: false,\n})\n"})}),"\n",(0,r.jsx)(n.h3,{id:"Overwrite-existing-screenshots",children:"Overwrite existing screenshots"}),"\n",(0,r.jsxs)(n.p,{children:["By default, Cypress saves unique screenshot files for every screenshot that is\ntaken within the same test. You can choose to overwrite existing screenshots\nwith the same file name using the ",(0,r.jsx)(n.code,{children:"overwrite"})," option."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"Cypress.Screenshot.defaults({\n  overwrite: true,\n})\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"Scale-viewport-and-fullPage-captures",children:["Scale ",(0,r.jsx)(n.code,{children:"viewport"})," and ",(0,r.jsx)(n.code,{children:"fullPage"})," captures"]}),"\n",(0,r.jsxs)(n.p,{children:["By default, scaling the application under test is turned off during when the\n",(0,r.jsx)(n.code,{children:"capture"})," option is ",(0,r.jsx)(n.code,{children:"viewport"})," to prevent differences between screenshots on\nscreens with different resolutions. You can turn scaling on and have your app\nscaled like it is during normal use of Cypress. This is always coerced to ",(0,r.jsx)(n.code,{children:"true"}),"\nif the ",(0,r.jsx)(n.code,{children:"capture"})," option is ",(0,r.jsx)(n.code,{children:"runner"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"Cypress.Screenshot.defaults({\n  scale: true,\n})\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"Change-the-DOM-using-onBeforeScreenshot-and-onAfterScreenshot",children:["Change the DOM using ",(0,r.jsx)(n.code,{children:"onBeforeScreenshot"})," and ",(0,r.jsx)(n.code,{children:"onAfterScreenshot"})]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"onBeforeScreenshot"})," and ",(0,r.jsx)(n.code,{children:"onAfterScreenshot"})," callbacks provide an\nopportunity to synchronously change the DOM to create a more consistent state\nfor the screenshot."]}),"\n",(0,r.jsxs)(n.p,{children:["In this example, imagine there is a clock in your app showing the current time.\nThis can cause screenshots to be non-deterministic, which could create false\nnegatives when screenshot diffing. You can use ",(0,r.jsx)(n.code,{children:"onBeforeScreenshot"})," to hide the\nclock and then show it again with ",(0,r.jsx)(n.code,{children:"onAfterScreenshot"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"Cypress.Screenshot.defaults({\n  onBeforeScreenshot($el) {\n    const $clock = $el.find('.clock')\n\n    if ($clock) {\n      $clock.hide()\n    }\n  },\n\n  onAfterScreenshot($el, props) {\n    const $clock = $el.find('.clock')\n\n    if ($clock) {\n      $clock.show()\n    }\n  },\n})\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"Get-properties-from-the-onAfterScreenshot-callback",children:["Get properties from the ",(0,r.jsx)(n.code,{children:"onAfterScreenshot"})," callback"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"Cypress.Screenshot.defaults({\n  onAfterScreenshot($el, props) {\n    // props has information about the screenshot,\n    // including but not limited to the following:\n    // {\n    //   path: '/Users/janelane/project/screenshots/my-screenshot.png',\n    //   size: '15 kb',\n    //   dimensions: {\n    //     width: 1000,\n    //     height: 660,\n    //   },\n    //   scaled: true,\n    //   blackout: ['.foo'],\n    //   duration: 2300,\n    // }\n  },\n})\n"})}),"\n",(0,r.jsx)(n.h2,{id:"Notes",children:"Notes"}),"\n",(0,r.jsx)(n.h4,{id:"Where-to-put-screenshot-configuration",children:"Where to put screenshot configuration"}),"\n",(0,r.jsx)(i,{}),"\n",(0,r.jsx)(n.h2,{id:"History",children:"History"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Version"}),(0,r.jsx)(n.th,{children:"Changes"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"/app/references/changelog#8-7-0",children:"8.7.0"})}),(0,r.jsxs)(n.td,{children:["Added ",(0,r.jsx)(n.code,{children:"overwrite"})," configuration option."]})]})})]}),"\n",(0,r.jsx)(n.h2,{id:"See-also",children:"See also"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/api/commands/screenshot",children:"cy.screenshot()"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/cloud/get-started/introduction",children:"Cypress Cloud"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/app/guides/screenshots-and-videos",children:"Screenshots and Videos"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/app/tooling/visual-testing",children:"Visual Testing"})}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}function u(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},1151:(e,n,s)=>{s.d(n,{Z:()=>c,a:()=>o});var r=s(7294);const t={},i=r.createContext(t);function o(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);