"use strict";(self.webpackChunkcypress_docusaurus_zh=self.webpackChunkcypress_docusaurus_zh||[]).push([[2871],{8133:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>a});var t=s(5893),i=s(1151);const c={title:"exec"},o=void 0,r={id:"api/commands/exec",title:"exec",description:"Execute a system command.",source:"@site/docs/api/commands/exec.mdx",sourceDirName:"api/commands",slug:"/api/commands/exec",permalink:"/api/commands/exec",draft:!1,unlisted:!1,editUrl:"https://github.com/cypress-io/cypress-documentation/tree/main/docs/api/commands/exec.mdx",tags:[],version:"current",lastUpdatedAt:1732009455,formattedLastUpdatedAt:"Nov 19, 2024",frontMatter:{title:"exec"},sidebar:"api",previous:{title:"eq",permalink:"/api/commands/eq"},next:{title:"filter",permalink:"/api/commands/filter"}},d={},a=[{value:"Syntax",id:"Syntax",level:2},{value:"Usage",id:"Usage",level:3},{value:"Arguments",id:"Arguments",level:3},{value:"Yields <Icon></Icon>",id:"Yields",level:3},{value:"Examples",id:"Examples",level:2},{value:"Command",id:"Command",level:3},{value:"Run a build command",id:"Run-a-build-command",level:4},{value:"Seed the database and assert it was successful",id:"Seed-the-database-and-assert-it-was-successful",level:4},{value:"Run an arbitrary script and assert its output",id:"Run-an-arbitrary-script-and-assert-its-output",level:4},{value:"Write to a file to create a fixture from response body",id:"Write-to-a-file-to-create-a-fixture-from-response-body",level:4},{value:"Options",id:"Options",level:3},{value:"Change the timeout",id:"Change-the-timeout",level:4},{value:"Choose to not fail on non-zero exit and assert on code and stderr",id:"Choose-to-not-fail-on-non-zero-exit-and-assert-on-code-and-stderr",level:4},{value:"Specify environment variables",id:"Specify-environment-variables",level:4},{value:"Notes",id:"Notes",level:2},{value:"Commands Must Exit",id:"Commands-Must-Exit",level:3},{value:"Commands that do not exit are not supported",id:"Commands-that-do-not-exit-are-not-supported",level:4},{value:"Reset timeout via <code>Cypress.config()</code>",id:"Reset-timeout-via-Cypressconfig",level:3},{value:"Set timeout in the test configuration",id:"Set-timeout-in-the-test-configuration",level:3},{value:"Rules",id:"Rules",level:2},{value:"Requirements <Icon></Icon>",id:"Requirements",level:3},{value:"Assertions <Icon></Icon>",id:"Assertions",level:3},{value:"Timeouts <Icon></Icon>",id:"Timeouts",level:3},{value:"Command Log",id:"Command-Log",level:2},{value:"See also",id:"See-also",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components},{DocsImage:s,Icon:c}=n;return s||x("DocsImage",!0),c||x("Icon",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Execute a system command."}),"\n",(0,t.jsxs)(n.admonition,{type:"caution",children:[(0,t.jsx)("strong",{children:"Anti-Pattern"}),(0,t.jsxs)(n.p,{children:["Don't try to start a web server from ",(0,t.jsx)(n.code,{children:"cy.exec()"}),"."]}),(0,t.jsxs)(n.p,{children:["Read about ",(0,t.jsx)(n.a,{href:"/app/core-concepts/best-practices#Web-Servers",children:"best practices"})," here."]})]}),"\n",(0,t.jsx)(n.h2,{id:"Syntax",children:"Syntax"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"cy.exec(command)\ncy.exec(command, options)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"Usage",children:"Usage"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(c,{name:"check-circle",color:"green"})," ",(0,t.jsx)(n.strong,{children:"Correct Usage"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"cy.exec('npm run build')\n"})}),"\n",(0,t.jsx)(n.h3,{id:"Arguments",children:"Arguments"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(c,{name:"angle-right"})," ",(0,t.jsxs)(n.strong,{children:["command ",(0,t.jsx)(n.em,{children:"(String)"})]})]}),"\n",(0,t.jsxs)(n.p,{children:["The system command to be executed from the project root (the directory that\ncontains the ",(0,t.jsx)(n.a,{href:"/app/references/configuration",children:"Cypress configuration file"}),")."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(c,{name:"angle-right"})," ",(0,t.jsxs)(n.strong,{children:["options ",(0,t.jsx)(n.em,{children:"(Object)"})]})]}),"\n",(0,t.jsxs)(n.p,{children:["Pass in an options object to change the default behavior of ",(0,t.jsx)(n.code,{children:"cy.exec()"}),"."]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Option"}),(0,t.jsx)(n.th,{children:"Default"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"log"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"true"})}),(0,t.jsxs)(n.td,{children:["Displays the command in the ",(0,t.jsx)(n.a,{href:"/app/core-concepts/open-mode#Command-Log",children:"Command log"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"env"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"{}"})}),(0,t.jsxs)(n.td,{children:["Object of environment variables to set before the command executes (e.g. ",(0,t.jsx)(n.code,{children:"{USERNAME: 'johndoe'}"}),"). Will be merged with existing system environment variables"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"failOnNonZeroExit"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"true"})}),(0,t.jsx)(n.td,{children:"whether to fail if the command exits with a non-zero code"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"timeout"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"/app/references/configuration#Timeouts",children:(0,t.jsx)(n.code,{children:"execTimeout"})})}),(0,t.jsxs)(n.td,{children:["Time to wait for ",(0,t.jsx)(n.code,{children:"cy.exec()"})," to resolve before ",(0,t.jsx)(n.a,{href:"#Timeouts",children:"timing out"})]})]})]})]}),"\n",(0,t.jsxs)(n.h3,{id:"Yields",children:["Yields ",(0,t.jsx)(n.a,{href:"/app/core-concepts/introduction-to-cypress#Subject-Management",children:(0,t.jsx)(c,{name:"question-circle"})})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"cy.exec()"})," yields an object with the following properties:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"code"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"stdout"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"stderr"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"Examples",children:"Examples"}),"\n",(0,t.jsx)(n.h3,{id:"Command",children:"Command"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"cy.exec()"})," provides an escape hatch for running arbitrary system commands, so\nyou can take actions necessary for your test outside the scope of Cypress. This\nis great for:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Running build scripts"}),"\n",(0,t.jsx)(n.li,{children:"Seeding your test database"}),"\n",(0,t.jsx)(n.li,{children:"Starting processes"}),"\n",(0,t.jsx)(n.li,{children:"Killing processes"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"Run-a-build-command",children:"Run a build command"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"cy.exec('npm run build').then((result) => {\n  // yields the 'result' object\n  // {\n  //   code: 0,\n  //   stdout: \"Files successfully built\",\n  //   stderr: \"\"\n  // }\n})\n"})}),"\n",(0,t.jsx)(n.h4,{id:"Seed-the-database-and-assert-it-was-successful",children:"Seed the database and assert it was successful"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"cy.exec('rake db:seed').its('code').should('eq', 0)\n"})}),"\n",(0,t.jsx)(n.h4,{id:"Run-an-arbitrary-script-and-assert-its-output",children:"Run an arbitrary script and assert its output"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"cy.exec('npm run my-script')\n  .its('stdout')\n  .should('contain', 'Done running the script')\n"})}),"\n",(0,t.jsx)(n.h4,{id:"Write-to-a-file-to-create-a-fixture-from-response-body",children:"Write to a file to create a fixture from response body"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"cy.intercept('POST', '/comments').as('postComment')\ncy.get('.add-comment').click()\ncy.wait('@postComment').then(({ response }) => {\n  cy.exec(\n    `echo ${JSON.stringify(response.body)} >cypress/fixtures/comment.json`\n  )\n  cy.fixture('comment.json').should('deep.eq', response.body)\n})\n"})}),"\n",(0,t.jsx)(n.h3,{id:"Options",children:"Options"}),"\n",(0,t.jsx)(n.h4,{id:"Change-the-timeout",children:"Change the timeout"}),"\n",(0,t.jsxs)(n.p,{children:["You can increase the time allowed to execute the command, although ",(0,t.jsx)(n.em,{children:"we don't\nrecommend executing commands that take a long time to exit"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Cypress will ",(0,t.jsx)(n.em,{children:"not"})," continue running any other commands until ",(0,t.jsx)(n.code,{children:"cy.exec()"})," has\nfinished, so a long-running command will drastically slow down your test cycle."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// will fail if script takes longer than 20 seconds to finish\ncy.exec('npm run build', { timeout: 20000 })\n"})}),"\n",(0,t.jsx)(n.h4,{id:"Choose-to-not-fail-on-non-zero-exit-and-assert-on-code-and-stderr",children:"Choose to not fail on non-zero exit and assert on code and stderr"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"cy.exec('man bear pig', { failOnNonZeroExit: false }).then((result) => {\n  expect(result.code).to.eq(1)\n  expect(result.stderr).to.contain('No manual entry for bear')\n})\n"})}),"\n",(0,t.jsx)(n.h4,{id:"Specify-environment-variables",children:"Specify environment variables"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"cy.exec('echo $USERNAME', { env: { USERNAME: 'johndoe' } })\n  .its('stdout')\n  .should('contain', 'johndoe')\n"})}),"\n",(0,t.jsx)(n.h2,{id:"Notes",children:"Notes"}),"\n",(0,t.jsx)(n.h3,{id:"Commands-Must-Exit",children:"Commands Must Exit"}),"\n",(0,t.jsx)(n.h4,{id:"Commands-that-do-not-exit-are-not-supported",children:"Commands that do not exit are not supported"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"cy.exec()"})," does not support commands that don't exit, such as:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Starting a ",(0,t.jsx)(n.code,{children:"rails server"})]}),"\n",(0,t.jsx)(n.li,{children:"A task that runs a watch"}),"\n",(0,t.jsx)(n.li,{children:"Any process that needs to be manually interrupted to stop"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["A command must exit within the ",(0,t.jsx)(n.code,{children:"execTimeout"})," or Cypress will kill the command's\nprocess and fail the current test."]}),"\n",(0,t.jsxs)(n.h3,{id:"Reset-timeout-via-Cypressconfig",children:["Reset timeout via ",(0,t.jsx)(n.code,{children:"Cypress.config()"})]}),"\n",(0,t.jsxs)(n.p,{children:["You can change the timeout of ",(0,t.jsx)(n.code,{children:"cy.exec()"})," for the remainder of the tests by\nsetting the new values for ",(0,t.jsx)(n.code,{children:"execTimeout"})," within\n",(0,t.jsx)(n.a,{href:"/api/cypress-api/config",children:"Cypress.config()"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"Cypress.config('execTimeout', 30000)\nCypress.config('execTimeout') // => 30000\n"})}),"\n",(0,t.jsx)(n.h3,{id:"Set-timeout-in-the-test-configuration",children:"Set timeout in the test configuration"}),"\n",(0,t.jsxs)(n.p,{children:["You can configure the ",(0,t.jsx)(n.code,{children:"cy.exec()"})," timeout within a suite or test by passing the\nnew configuration value within the\n",(0,t.jsx)(n.a,{href:"/app/references/configuration#Test-Configuration",children:"test configuration"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["This will set the timeout throughout the duration of the tests, then return it\nto the default ",(0,t.jsx)(n.code,{children:"execTimeout"})," when complete."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"describe('has data available from database', { execTimeout: 90000 }, () => {\n  before(() => {\n    cy.exec('rake db:seed')\n  })\n\n  // tests\n\n  after(() => {\n    cy.exec('rake db:reset')\n  })\n})\n"})}),"\n",(0,t.jsx)(n.h2,{id:"Rules",children:"Rules"}),"\n",(0,t.jsxs)(n.h3,{id:"Requirements",children:["Requirements ",(0,t.jsx)(n.a,{href:"/app/core-concepts/introduction-to-cypress#Chains-of-Commands",children:(0,t.jsx)(c,{name:"question-circle"})})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"cy.exec()"})," requires being chained off of ",(0,t.jsx)(n.code,{children:"cy"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"cy.exec()"})," requires the executed system command to eventually exit."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"cy.exec()"})," requires that the exit code be ",(0,t.jsx)(n.code,{children:"0"})," when ",(0,t.jsx)(n.code,{children:"failOnNonZeroExit"})," is\n",(0,t.jsx)(n.code,{children:"true"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"Assertions",children:["Assertions ",(0,t.jsx)(n.a,{href:"/app/core-concepts/introduction-to-cypress#Assertions",children:(0,t.jsx)(c,{name:"question-circle"})})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"cy.exec()"})," will only run assertions you have chained once, and will not\n",(0,t.jsx)(n.a,{href:"/app/core-concepts/retry-ability",children:"retry"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"Timeouts",children:["Timeouts ",(0,t.jsx)(n.a,{href:"/app/core-concepts/introduction-to-cypress#Timeouts",children:(0,t.jsx)(c,{name:"question-circle"})})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"cy.exec()"})," can time out waiting for the system command to exist."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"Command-Log",children:"Command Log"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.em,{children:"List the contents of your package.json file"})})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"if (Cypress.platform === 'win32') {\n  cy.exec('type package.json').its('stderr').should('be.empty')\n} else {\n  cy.exec('cat package.json').its('stderr').should('be.empty')\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"The command above will display in the Command Log as:"}),"\n",(0,t.jsx)(s,{src:"/img/api/exec/exec-cat-in-shell.png",alt:"Command Log exec"}),"\n",(0,t.jsxs)(n.p,{children:["When clicking on the ",(0,t.jsx)(n.code,{children:"exec"})," command within the command log, the console outputs\nthe following:"]}),"\n",(0,t.jsx)(s,{src:"/img/api/exec/console-shows-code-shell-stderr-and-stdout-for-exec.png",alt:"console.log exec"}),"\n",(0,t.jsx)(n.h2,{id:"See-also",children:"See also"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/api/commands/readfile",children:(0,t.jsx)(n.code,{children:"cy.readFile()"})})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/api/commands/request",children:(0,t.jsx)(n.code,{children:"cy.request()"})})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/api/commands/task",children:(0,t.jsx)(n.code,{children:"cy.task()"})})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/api/commands/writefile",children:(0,t.jsx)(n.code,{children:"cy.writeFile()"})})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}function x(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},1151:(e,n,s)=>{s.d(n,{Z:()=>r,a:()=>o});var t=s(7294);const i={},c=t.createContext(i);function o(e){const n=t.useContext(c);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(c.Provider,{value:n},e.children)}}}]);